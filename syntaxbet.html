<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyntaxBet - Word Formation Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0a2e5a;
            --secondary: #1a4789;
            --accent: #ff9d00;
            --accent-gradient: linear-gradient(to right, #ff9d00, #ffcc00);
            --text-light: #ffffff;
            --text-gray: #a0c1ed;
            --card-bg: #1a3e75;
            --card-dark: #0f2b50;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            animation: fadeIn 0.8s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            color: var(--text-light);
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        h1 i {
            color: var(--accent);
        }

        .subtitle {
            color: var(--text-gray);
            font-size: 1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            animation: slideUp 0.5s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
        }

        .panel-title i {
            font-size: 1.2rem;
        }

        .topic-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .betting-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .bet-amount {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bet-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
        }

        .bet-input::placeholder {
            color: var(--text-gray);
        }

        .word-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .word-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .word-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            background: var(--card-bg);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .word-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .word-btn.active {
            background: var(--accent-gradient);
            color: var(--primary);
            box-shadow: 0 5px 15px rgba(255, 157, 0, 0.4);
        }

        .word-btn .btn-label {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .word-btn .btn-payout {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .place-bet-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            background: var(--accent-gradient);
            color: var(--primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(255, 157, 0, 0.4);
        }

        .place-bet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 157, 0, 0.6);
        }

        .place-bet-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
            max-height: 280px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .number {
            background: var(--card-bg);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
            color: var(--text-light);
        }

        .number:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: 0 5px 15px rgba(255, 157, 0, 0.2);
        }

        .number.selected {
            background: var(--accent-gradient);
            color: var(--primary);
            border-color: var(--accent);
        }

        .number.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .sentence-area {
            min-height: 120px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .sentence-word {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent);
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: popIn 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 157, 0, 0.1);
            color: var(--text-light);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(10, 46, 90, 0.3);
        }

        .btn-secondary {
            background: var(--accent);
            color: var(--primary);
        }

        .btn-secondary:hover {
            background: #ffb133;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 157, 0, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3ab0d9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
        }

        .ai-response {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        .ai-response.show {
            display: block;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .ai-header i {
            font-size: 1.5rem;
        }

        .score-display {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-item {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
        }

        .score-label {
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .examples {
            margin-top: 25px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .example {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .rules {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .rules ul {
            padding-left: 20px;
            margin-top: 10px;
        }

        .rules li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 157, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 157, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 157, 0, 0); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 300px;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile-specific adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .panel {
                padding: 15px;
            }
            
            .numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 6px;
            }
            
            .number {
                height: 50px;
                font-size: 1rem;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.85rem;
            }
            
            .controls {
                gap: 8px;
            }
            
            .score-item {
                min-width: 80px;
            }
            
            .score-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .game-area {
                gap: 15px;
            }
            
            .numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            }
            
            .number {
                height: 45px;
                font-size: 0.9rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-water"></i> SyntaxBet</h1>
            <p class="subtitle">Form meaningful phrases, clauses, or sentences by selecting words in the rightward order. Challenge your syntax skills with our AI-powered evaluation system.</p>
        </header>

        <div class="game-area">
            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-comments"></i> Topic & Betting</h2>
                
                <div class="topic-box" id="topicBox">
                    Loading topic...
                </div>

                <div class="betting-controls">
                    <div class="bet-amount">
                        <input type="number" class="bet-input" id="betAmount" placeholder="Enter bet amount" min="1" value="10">
                    </div>

                    <div class="word-buttons">
                        <button class="word-btn" data-words="3">
                            <span class="btn-label">W3</span>
                            <span class="btn-payout">Payout: 2x</span>
                        </button>
                        <button class="word-btn" data-words="4">
                            <span class="btn-label">W4</span>
                            <span class="btn-payout">Payout: 3x</span>
                        </button>
                        <button class="word-btn" data-words="5">
                            <span class="btn-label">W5</span>
                            <span class="btn-payout">Payout: 4x</span>
                        </button>
                        <button class="word-btn" data-words="6">
                            <span class="btn-label">W6</span>
                            <span class="btn-payout">Payout: 5x</span>
                        </button>
                        <button class="word-btn" data-words="7">
                            <span class="btn-label">W7</span>
                            <span class="btn-payout">Payout: 6x</span>
                        </button>
                        <button class="word-btn" data-words="8">
                            <span class="btn-label">W8</span>
                            <span class="btn-payout">Payout: 7x</span>
                        </button>
                        <button class="word-btn" data-words="9">
                            <span class="btn-label">W9</span>
                            <span class="btn-payout">Payout: 8x</span>
                        </button>
                        <button class="word-btn" data-words="10">
                            <span class="btn-label">W10</span>
                            <span class="btn-payout">Payout: 10x</span>
                        </button>
                    </div>

                    <button class="place-bet-btn" id="placeBetBtn" disabled>
                        <i class="fas fa-coins"></i> Place Bet
                    </button>
                </div>

                <div class="score-display">
                    <div class="score-item">
                        <div class="score-value" id="balanceValue">1000</div>
                        <div class="score-label">Balance</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="winValue">0</div>
                        <div class="score-label">Winnings</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="betValue">0</div>
                        <div class="score-label">Current Bet</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-th-large"></i> Word Selection & Sentence Construction</h2>
                
                <div class="numbers-grid" id="numbersGrid">
                    <!-- Numbers 1-100 will be generated by JavaScript -->
                </div>

                <div class="sentence-area" id="sentenceArea">
                    <!-- Words will appear here when selected -->
                    <p id="placeholderText">Select words to build your sentence...</p>
                </div>

                <div class="controls">
                    <button class="btn-success" id="validateSentence">
                        <i class="fas fa-check-circle"></i> Validate Sentence
                    </button>
                    <button class="btn-secondary" id="newRound">
                        <i class="fas fa-sync-alt"></i> New Round
                    </button>
                </div>

                <div class="ai-response" id="aiResponse">
                    <div class="ai-header">
                        <i class="fas fa-robot"></i>
                        <h3>AI Evaluation</h3>
                    </div>
                    <div id="aiText">Waiting for evaluation...</div>
                </div>
            </div>
        </div>

        <div class="examples">
            <h2 class="panel-title"><i class="fas fa-lightbulb"></i> Example Sentences</h2>
            <div class="examples-grid">
                <div class="example">W3: [I] [AM] [HERE]</div>
                <div class="example">W4: [BRING] [BACK] [MY] [PHONE]</div>
                <div class="example">W5: [STAY] [WITH] [US] [FOR] [NOW]</div>
                <div class="example">W6: [IT] [ONLY] [WORKS] [FOR] [YOUNG] [PEOPLE]</div>
                <div class="example">W7: [YOU] [CANNOT] [GO] [TO] [THE] [GYM] [ALONE]</div>
                <div class="example">W8: [WHY] [IS] [IT] [TAKING] [TOO] [LONG] [TO] [LAND]</div>
            </div>
        </div>

        <div class="rules">
            <h2 class="panel-title"><i class="fas fa-info-circle"></i> Game Rules</h2>
            <ul>
                <li>Place a bet and select a word count (W3-W10)</li>
                <li>Select the specified number of words from the number grid</li>
                <li>Words appear directly in the sentence area when selected</li>
                <li>Words must be arranged in the correct grammatical order</li>
                <li>Use the validation button to check if your sentence matches the topic</li>
                <li>Win your bet multiplied by the payout rate if your sentence is valid</li>
                <li>Challenge yourself to create more complex sentences for higher payouts</li>
            </ul>
        </div>

        <footer>
            <p>SyntaxBet &copy; 2023 | Part of the EnglaBet Language Learning System</p>
        </footer>
    </div>

    <script>
        // Game state
        let selectedNumbers = [];
        let sentenceWords = [];
        let balance = 1000;
        let currentBet = 0;
        let selectedWordCount = 0;
        let currentTopic = "";
        let wordDatabase = {};
        let roundActive = false;

        // DOM elements
        const numbersGrid = document.getElementById('numbersGrid');
        const sentenceArea = document.getElementById('sentenceArea');
        const placeholderText = document.getElementById('placeholderText');
        const topicBox = document.getElementById('topicBox');
        const betAmountInput = document.getElementById('betAmount');
        const placeBetBtn = document.getElementById('placeBetBtn');
        const wordButtons = document.querySelectorAll('.word-btn');
        const validateSentenceBtn = document.getElementById('validateSentence');
        const newRoundBtn = document.getElementById('newRound');
        const aiResponse = document.getElementById('aiResponse');
        const aiText = document.getElementById('aiText');
        const balanceValue = document.getElementById('balanceValue');
        const winValue = document.getElementById('winValue');
        const betValue = document.getElementById('betValue');

        // Cohere API key
        const COHERE_API_KEY = "OjpC1Vsdtpebb9lRygjkMIklrFItDJF4RM3tFEoy";

        // Initialize the game
        function initGame() {
            // Generate random topic using Cohere API
            generateRandomTopic();
            
            // Create number grid
            numbersGrid.innerHTML = '';
            for (let i = 1; i <= 100; i++) {
                const numberElement = document.createElement('div');
                numberElement.className = 'number';
                numberElement.textContent = i;
                numberElement.dataset.number = i;
                
                numberElement.addEventListener('click', () => {
                    toggleNumberSelection(i, numberElement);
                });
                
                numbersGrid.appendChild(numberElement);
            }

            // Event listeners
            placeBetBtn.addEventListener('click', placeBet);
            validateSentenceBtn.addEventListener('click', validateSentence);
            newRoundBtn.addEventListener('click', startNewRound);
            
            // Word button event listeners
            wordButtons.forEach(button => {
                button.addEventListener('click', () => {
                    selectWordCount(parseInt(button.dataset.words));
                });
            });

            // Update UI
            updateUI();
        }

        // Generate random topic using Cohere API
        async function generateRandomTopic() {
            topicBox.innerHTML = '<div class="loading"></div> Generating topic...';
            
            try {
                const response = await fetch('https://api.cohere.ai/v1/generate', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${COHERE_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'command',
                        prompt: 'Generate a short dialogue between two people on a random everyday topic. The dialogue should be between 4-8 lines total, with each line being a complete sentence. Format it like this example:\n\nDialogue Bank [Topic] ⬇\n\nPERSON1: [FIRST SENTENCE] [SECOND SENTENCE]\nPERSON2: [THIRD SENTENCE] [FOURTH SENTENCE]\n\nPlease create a completely different dialogue on a new topic. Do not use restaurant or food-related topics.',
                        max_tokens: 300,
                        temperature: 0.8,
                        k: 0,
                        stop_sequences: [],
                        return_likelihoods: 'NONE'
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate topic');
                }

                const data = await response.json();
                const generatedTopic = data.generations[0].text;
                
                currentTopic = generatedTopic;
                topicBox.textContent = generatedTopic;
                
                // Generate word database based on topic
                generateWordDatabase(generatedTopic);
            } catch (error) {
                console.error('Error generating topic:', error);
                // Fallback to a default topic if API fails
                const fallbackTopic = `Dialogue Bank [Travel Plans] ⬇

PERSON1: [WHERE ARE YOU PLANNING TO GO] [WHEN WILL YOU LEAVE]
PERSON2: [I WANT TO VISIT JAPAN] [I WILL TRAVEL NEXT MONTH]
PERSON1: [HOW LONG WILL YOU STAY] [HAVE YOU BOOKED YOUR FLIGHT]
PERSON2: [I WILL STAY FOR TWO WEEKS] [I NEED TO FIND A HOTEL FIRST]`;
                
                currentTopic = fallbackTopic;
                topicBox.textContent = fallbackTopic;
                generateWordDatabase(fallbackTopic);
            }
        }

        // Generate word database from topic
        function generateWordDatabase(topic) {
            wordDatabase = {};
            
            // Extract words from the topic
            const words = topic
                .replace(/[\[\]]/g, ' ') // Remove brackets
                .replace(/[^\w\s]/g, '') // Remove punctuation
                .toUpperCase()
                .split(/\s+/)
                .filter(word => word.length > 1) // Remove single letters
                .filter((word, index, self) => self.indexOf(word) === index); // Remove duplicates
            
            // Fill the rest with random words if needed
            const dictionaryWords = [
                "ABOUT", "AFTER", "AGAIN", "AIR", "ALL", "ALONG", "ALSO", "AN", "AND", "ANOTHER", "ANY", "ARE", "AROUND", "AS", "AT", "AWAY", "BACK", "BE", "BECAUSE", "BEEN", "BEFORE", "BEGAN", "BEST", "BETTER", "BIG", "BLACK", "BLUE", "BOOK", "BOTH", "BOX", "BRING", "BUT", "BY", "CALL", "CAME", "CAN", "CAR", "CARE", "CARRIED", "CARRY", "CHANGE", "CITY", "CLOSE", "COME", "COULD", "CUT", "DARK", "DAY", "DID", "DIFFERENT", "DO", "DOES", "DONT", "DOWN", "EACH", "END", "EVEN", "EVERY", "EYE", "FACE", "FALL", "FAR", "FARM", "FAST", "FATHER", "FEET", "FEW", "FIND", "FIRST", "FIVE", "FLY", "FOOD", "FOR", "FORM", "FOUND", "FOUR", "FROM", "FULL", "GAVE", "GET", "GIVE", "GO", "GOING", "GOOD", "GOT", "GREAT", "GREEN", "GROW", "HAD", "HAND", "HARD", "HAS", "HAVE", "HE", "HEAD", "HEAR", "HELP", "HER", "HERE", "HIGH", "HIM", "HIS", "HOME", "HOUSE", "HOW", "I", "IF", "IN", "INTO", "IS", "IT", "ITS", "JUST", "KEEP", "KIND", "KNOW", "LAND", "LARGE", "LAST", "LATE", "LAUGH", "LEARN", "LEFT", "LET", "LETTER", "LIFE", "LIGHT", "LIKE", "LINE", "LISTEN", "LITTLE", "LIVE", "LONG", "LOOK", "MADE", "MAKE", "MAN", "MANY", "MAY", "ME", "MEN", "MIGHT", "MILE", "MISS", "MORE", "MOST", "MOTHER", "MOUNTAIN", "MOVE", "MUCH", "MUST", "MY", "MYSELF", "NAME", "NEAR", "NEED", "NEVER", "NEW", "NEXT", "NIGHT", "NO", "NOT", "NOW", "NUMBER", "OF", "OFF", "OLD", "ON", "ONCE", "ONE", "ONLY", "OPEN", "OR", "OTHER", "OUR", "OUT", "OVER", "OWN", "PAGE", "PART", "PEOPLE", "PICTURE", "PLACE", "PLAY", "POINT", "PUT", "READ", "RED", "RIGHT", "ROOM", "RUN", "SAID", "SAME", "SAW", "SAY", "SCHOOL", "SEE", "SEEM", "SENTENCE", "SET", "SHE", "SHOULD", "SHOW", "SIDE", "SMALL", "SO", "SOME", "SOMETHING", "SOON", "SOUND", "SPELL", "START", "STATE", "STILL", "STOP", "STORY", "STUDY", "SUCH", "TAKE", "TALK", "TELL", "THAN", "THAT", "THE", "THEIR", "THEM", "THEN", "THERE", "THESE", "THEY", "THING", "THINK", "THIS", "THOSE", "THOUGHT", "THREE", "THROUGH", "TIME", "TO", "TOGETHER", "TOO", "TOOK", "TREE", "TURN", "TWO", "UNDER", "UP", "US", "USE", "VERY", "WALK", "WANT", "WAS", "WATCH", "WATER", "WAY", "WE", "WELL", "WENT", "WERE", "WHAT", "WHEN", "WHERE", "WHICH", "WHILE", "WHITE", "WHO", "WHY", "WILL", "WITH", "WORD", "WORK", "WORLD", "WOULD", "WRITE", "YEAR", "YES", "YOU", "YOUR"
            ];
            
            // Shuffle dictionary words
            const shuffledDictionary = [...dictionaryWords].sort(() => 0.5 - Math.random());
            
            // Create an array of all numbers from 1 to 100
            const allNumbers = Array.from({length: 100}, (_, i) => i + 1);
            
            // Shuffle the numbers randomly
            const shuffledNumbers = [...allNumbers].sort(() => 0.5 - Math.random());
            
            // Assign words to shuffled numbers
            for (let i = 0; i < 100; i++) {
                if (i < words.length) {
                    wordDatabase[shuffledNumbers[i]] = words[i];
                } else {
                    wordDatabase[shuffledNumbers[i]] = shuffledDictionary[i - words.length] || "WORD";
                }
            }
        }

        // Select word count
        function selectWordCount(count) {
            selectedWordCount = count;
            
            // Update UI
            wordButtons.forEach(button => {
                if (parseInt(button.dataset.words) === count) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Enable/disable place bet button
            placeBetBtn.disabled = !(selectedWordCount > 0 && betAmountInput.value > 0);
        }

        // Place bet
        function placeBet() {
            const betAmount = parseInt(betAmountInput.value);
            
            if (betAmount <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            
            if (betAmount > balance) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            if (selectedWordCount < 3 || selectedWordCount > 10) {
                showNotification('Please select a word count between 3 and 10', 'error');
                return;
            }
            
            // Deduct bet from balance
            balance -= betAmount;
            currentBet = betAmount;
            
            // Start the round
            roundActive = true;
            
            // Update UI
            updateUI();
            
            // Disable betting controls
            betAmountInput.disabled = true;
            placeBetBtn.disabled = true;
            wordButtons.forEach(button => {
                button.disabled = true;
            });
            
            showNotification(`Bet placed: ${betAmount} coins on W${selectedWordCount}`, 'success');
        }

        // Start new round
        function startNewRound() {
            // Reset game state
            selectedNumbers = [];
            sentenceWords = [];
            currentBet = 0;
            selectedWordCount = 0;
            roundActive = false;
            
            // Clear UI
            sentenceArea.innerHTML = '';
            placeholderText.style.display = 'block';
            
            // Reset number grid
            document.querySelectorAll('.number').forEach(number => {
                number.classList.remove('selected', 'disabled');
            });
            
            // Enable betting controls
            betAmountInput.disabled = false;
            placeBetBtn.disabled = false;
            wordButtons.forEach(button => {
                button.disabled = false;
                button.classList.remove('active');
            });
            
            // Generate new topic
            generateRandomTopic();
            
            // Update UI
            updateUI();
            
            showNotification('New round started!', 'success');
        }

        // Toggle number selection
        function toggleNumberSelection(number, element) {
            if (!roundActive) {
                showNotification('Please place a bet first', 'error');
                return;
            }
            
            const index = selectedNumbers.indexOf(number);
            
            if (index === -1) {
                // Check if we've reached the maximum
                if (selectedNumbers.length >= selectedWordCount) {
                    showNotification(`You can only select ${selectedWordCount} words`, 'error');
                    return;
                }
                
                // Add to selection
                selectedNumbers.push(number);
                element.classList.add('selected');
                
                // Add word to sentence area
                addWordToSentence(number, wordDatabase[number]);
            }
            
            // Check if selection is complete
            if (selectedNumbers.length === selectedWordCount) {
                document.querySelectorAll('.number').forEach(num => {
                    if (!num.classList.contains('selected')) {
                        num.classList.add('disabled');
                    }
                });
            }
        }

        // Add word to sentence area
        function addWordToSentence(number, word) {
            // Hide placeholder
            placeholderText.style.display = 'none';
            
            const wordElement = document.createElement('div');
            wordElement.className = 'sentence-word';
            wordElement.textContent = word;
            wordElement.dataset.number = number;
            
            sentenceArea.appendChild(wordElement);
            
            sentenceWords.push({ number, word, element: wordElement });
        }

        // Validate sentence
        async function validateSentence() {
            if (!roundActive) {
                showNotification('Please place a bet first', 'error');
                return;
            }
            
            if (sentenceWords.length !== selectedWordCount) {
                showNotification(`Sentence must contain exactly ${selectedWordCount} words`, 'error');
                return;
            }
            
            const sentence = sentenceWords.map(item => item.word).join(' ');
            
            try {
                // Use AI to validate the sentence
                const isValid = await validateSentenceWithAI(sentence, currentTopic);
                
                if (isValid) {
                    // Calculate winnings based on word count
                    const payoutMultipliers = {
                        3: 2, 4: 3, 5: 4, 6: 5, 7: 6, 8: 7, 9: 8, 10: 10
                    };
                    
                    const winnings = currentBet * payoutMultipliers[selectedWordCount];
                    balance += winnings;
                    
                    // Update UI
                    winValue.textContent = winnings;
                    updateUI();
                    
                    // Show AI evaluation
                    showAIEvaluation(sentence, true, winnings);
                    
                    showNotification(`Congratulations! You won ${winnings} coins!`, 'success');
                    
                    // End the round
                    roundActive = false;
                } else {
                    showAIEvaluation(sentence, false, 0);
                    showNotification('Sentence does not match the topic. Try again!', 'error');
                }
            } catch (error) {
                console.error('Error validating sentence:', error);
                // Fallback to random validation if AI fails
                const isValid = Math.random() > 0.3; // 70% chance of being valid for demo
                
                if (isValid) {
                    const payoutMultipliers = {
                        3: 2, 4: 3, 5: 4, 6: 5, 7: 6, 8: 7, 9: 8, 10: 10
                    };
                    
                    const winnings = currentBet * payoutMultipliers[selectedWordCount];
                    balance += winnings;
                    
                    winValue.textContent = winnings;
                    updateUI();
                    
                    showAIEvaluation(sentence, true, winnings);
                    showNotification(`Congratulations! You won ${winnings} coins!`, 'success');
                    roundActive = false;
                } else {
                    showAIEvaluation(sentence, false, 0);
                    showNotification('Sentence does not match the topic. Try again!', 'error');
                }
            }
        }

        // Validate sentence with AI
        async function validateSentenceWithAI(sentence, topic) {
            try {
                const response = await fetch('https://api.cohere.ai/v1/classify', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${COHERE_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'embed-english-v2.0',
                        inputs: [`Sentence: ${sentence}\nTopic: ${topic}`],
                        examples: [
                            { text: "Sentence: I AM GOING TO THE STORE\nTopic: Dialogue Bank [Shopping] ⬇\nPERSON1: [WHAT DO YOU NEED TO BUY] [WHEN WILL YOU GO]\nPERSON2: [I NEED MILK AND BREAD] [I WILL GO THIS AFTERNOON]", label: "valid" },
                            { text: "Sentence: THE WEATHER IS NICE TODAY\nTopic: Dialogue Bank [Shopping] ⬇\nPERSON1: [WHAT DO YOU NEED TO BUY] [WHEN WILL YOU GO]\nPERSON2: [I NEED MILK AND BREAD] [I WILL GO THIS AFTERNOON]", label: "invalid" },
                            { text: "Sentence: CAN YOU HELP ME WITH THIS\nTopic: Dialogue Bank [Work Project] ⬇\nPERSON1: [HAVE YOU FINISHED THE REPORT] [WHEN IS THE DEADLINE]\nPERSON2: [I AM STILL WORKING ON IT] [IT IS DUE NEXT WEEK]", label: "valid" },
                            { text: "Sentence: I LIKE TO SWIM IN THE OCEAN\nTopic: Dialogue Bank [Work Project] ⬇\nPERSON1: [HAVE YOU FINISHED THE REPORT] [WHEN IS THE DEADLINE]\nPERSON2: [I AM STILL WORKING ON IT] [IT IS DUE NEXT WEEK]", label: "invalid" }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to validate sentence');
                }

                const data = await response.json();
                const classification = data.classifications[0];
                
                // Return true if the prediction is "valid"
                return classification.prediction === "valid";
            } catch (error) {
                console.error('Error with AI validation:', error);
                throw error;
            }
        }

        // Show AI evaluation
        function showAIEvaluation(sentence, isValid, winnings) {
            let evaluation = "";
            
            if (isValid) {
                evaluation = `
                    <p>Your sentence "<strong>${sentence}</strong>" is valid and matches the topic!</p>
                    <p>You won <strong>${winnings} coins</strong>!</p>
                    <p>The sentence follows proper grammatical structure and makes sense in the context of the dialogue.</p>
                `;
            } else {
                evaluation = `
                    <p>Your sentence "<strong>${sentence}</strong>" does not properly match the topic.</p>
                    <p>Try to create a sentence that fits within the context of the dialogue provided.</p>
                    <p>Consider the relationships between the characters and the situation described.</p>
                `;
            }
            
            aiText.innerHTML = evaluation;
            aiResponse.classList.add('show');
        }

        // Update UI
        function updateUI() {
            balanceValue.textContent = balance;
            betValue.textContent = currentBet;
        }

        // Show notification
        function showNotification(message, type) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>